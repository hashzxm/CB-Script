<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title> Similarity Slut Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-800 */
            transition: background-color 0.3s, color 0.3s;
        }
        .dark body {
            background-color: #111827; /* gray-900 */
            color: #d1d5db; /* gray-300 */
        }
        .card, .top-picks-card {
            background-color: white;
            border-color: #e5e7eb; /* gray-200 */
        }
        .dark .card, .dark .top-picks-card {
            background-color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .dark .card:hover {
             box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4);
        }
        .highlight {
            background-color: #d1fae5; /* green-200 */
        }
        .dark .highlight {
            background-color: #064e3b; /* green-900 */
        }
        .two-year-highlight {
            background-color: #dbeafe; /* blue-200 */
        }
        .dark .two-year-highlight {
            background-color: #1e3a8a; /* blue-900 */
        }
        .sim-highlight {
            background-color: #fef3c7; /* amber-200 */
        }
        .dark .sim-highlight {
            background-color: #78350f; /* amber-900 */
        }
        .highlight .player-name, .sim-highlight .player-name, .two-year-highlight .player-name {
            font-weight: 600;
        }
        .dark .highlight .player-name { color: #a7f3d0; }
        .dark .two-year-highlight .player-name { color: #93c5fd; }
        .dark .sim-highlight .player-name { color: #fcd34d; }

        .low-data {
            color: #6b7280; /* gray-500 */
            font-style: italic;
        }
        .dark .low-data {
            color: #9ca3af; /* gray-400 */
        }
        .table-header th {
            background-color: #f9fafb; /* gray-50 */
        }
        .dark .table-header th {
            background-color: #374151; /* gray-700 */
            color: #d1d5db; /* gray-300 */
        }
        .player-row:hover {
            background-color: #f9fafb; /* gray-50 */
        }
        .dark .player-row:hover {
            background-color: #374151; /* gray-700 */
        }
        .toggle-btn {
            transition: background-color 0.3s, color 0.3s;
        }
        .sortable {
            cursor: pointer;
            user-select: none;
        }
        .sortable:hover {
            background-color: #e5e7eb; /* gray-200 */
        }
        .dark .sortable:hover {
            background-color: #4b5563; /* gray-600 */
        }
        .sort-asc::after { content: ' ▲'; font-size: 0.7em; }
        .sort-desc::after { content: ' ▼'; font-size: 0.7em; }
        
        .dark .game-header { background-color: #374151; }
        .dark .text-gray-800 { color: #f9fafb; }
        .dark .text-gray-600 { color: #9ca3af; }

        /* Accordion Styles */
        details > summary {
            list-style: none;
            cursor: pointer;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details .summary-chevron {
            transition: transform 0.2s;
        }
        details[open] .summary-chevron {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div id="main-content">
        <div class="max-w-7xl mx-auto relative">
            <button id="theme-toggle" type="button" class="absolute top-0 left-0 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
            </button>
            <button id="zxm-button" class="absolute top-0 right-0 px-4 py-2 text-sm bg-gray-800 text-white font-bold rounded-lg shadow-lg hover:bg-black focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-75 transition-all transform hover:scale-105">
                zxm
            </button>
            <header class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Home Run Prediction Report</h1>
                <p class="text-gray-600 mt-2">August 3, 2025</p>
                <div class="flex flex-wrap justify-center items-center gap-2 mt-6">
                    <button id="toggle-90day-btn" class="px-4 py-2 text-sm bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 toggle-btn">
                        Toggle High 90-Day Prob
                    </button>
                     <button id="toggle-2year-btn" class="px-4 py-2 text-sm bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 toggle-btn">
                        Toggle Top 2-Year Prob
                    </button>
                     <button id="toggle-compscore-btn" class="px-4 py-2 text-sm bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 toggle-btn">
                        Toggle High HR Similarity
                    </button>
                    <button id="yep-button" class="px-4 py-2 text-sm bg-indigo-600 text-white font-bold rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition-transform transform hover:scale-105">
                        Yep
                    </button>
                </div>
            </header>

            <div id="top-picks-container" class="mb-8"></div>

            <main id="report-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </main>
            
            <div id="no-data-message" class="hidden text-center py-16">
                <p class="text-xl text-gray-500">No matching players found for this filter.</p>
            </div>

        </div>
        
        <footer class="mt-12 text-center">
            <iframe src="https://giphy.com/embed/krkrHAEodHgzP72rTI" width="480" height="269" style="max-width: 100%;" frameBorder="0" class="giphy-embed mx-auto" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/disneyplus-krkrHAEodHgzP72rTI" class="text-xs text-gray-500 dark:text-gray-400">via GIPHY</a></p>
        </footer>
    </div>

    <script>
        // Store the parsed data globally to avoid re-parsing
        let allGamesData = [];
        let currentSort = { key: null, order: 'desc' };
        let activeFilter = 'none'; // 'none', '90day', '2year', 'compscore'

        // Raw text data from the new report
        const reportText = `
========================================================================================================================
                                       HOME RUN PREDICTION REPORT FOR 2025-08-04

========================================================================================================================
                                     --- TOP 10 PICKS OF THE DAY (90-Day Model) ---

------------------------------------------------------------------------------------------------------------------------
  Rank  | Batter               | Pitcher              |     XGBoost     |    LightGBM     |    CatBoost     |   Final Score
  ----- | -------------------- | -------------------- | --------------- | --------------- | --------------- | ---------------
  #161  | Joey Loperfido       | Tanner Gordon        |      40.17%     |      35.05%     |      59.55%     |      83.41%
  #98   | Francisco Lindor     | Slade Cecconi        |      50.48%     |      19.24%     |      39.29%     |      82.28%
  #226  | Will Smith           | Sonny Gray           |      20.77%     |      29.77%     |      63.09%     |      66.02%
  #101  | Jeff McNeil          | Slade Cecconi        |      44.23%     |      19.84%     |      38.16%     |      59.53%
  #100  | Pete Alonso          | Slade Cecconi        |      67.93%     |      18.79%     |      20.74%     |      54.15%
  #229  | Andy Pages           | Sonny Gray           |      32.66%     |      20.25%     |      44.95%     |      54.11%
  #164  | Addison Barger       | Tanner Gordon        |      37.87%     |      9.92%      |      32.29%     |      50.72%
  #4    | Kody Clemens         | Casey Mize           |      59.78%     |      11.03%     |      17.74%     |      44.74%
  #6    | Royce Lewis          | Casey Mize           |      29.22%     |      14.48%     |      32.12%     |      12.97%
  #129  | Ben Rice             | Patrick Corbin       |      7.15%      |      12.80%     |      44.17%     |      10.95%

========================================================================================================================
GAME: Twins @ Tigers (6:40 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Tigers Batters vs. Travis Adams (Last 90d: 59 PA | 8.5% K | 5.1% BB | 3 BB | 1.7% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Kerry Carpenter           |      2.19%      |      0.23%      |      2/100
  Zach McKinstry            |      0.14%      |      1.05%      |      2/100
  Colt Keith                |      0.07%      |      1.31%      |      2/100
  Wenceel Pérez             |      0.03%      |      1.24%      |      2/100
  Javier Báez               |      0.01%      |      0.82%      |      2/100
  Dillon Dingler            |      0.01%      |      0.36%      |      2/100
  Gleyber Torres            |      0.01%      |      0.35%      |      2/100
  Riley Greene              |      0.01%      |      0.02%      |      2/100
  Spencer Torkelson         |      0.00%      |      0.23%      |      2/100

------------------------------------------------------------------------------------------------------------------------
  Twins Batters vs. Casey Mize (Last 90d: 259 PA | 11.2% K | 6.2% BB | 16 BB | 2.3% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Kody Clemens              |      44.74%     |      0.00%      |      54/100
  Royce Lewis               |      12.97%     |      0.00%      |      37/100
  Ryan Jeffers              |      1.63%      |      0.01%      |      31/100
  Matt Wallner              |      0.20%      |      0.00%      |      44/100
  Brooks Lee                |      0.09%      |      0.01%      |      39/100
  Trevor Larnach            |      0.03%      |      0.02%      |      29/100
  Austin Martin             |     Low Data    |      0.04%      |      4/100
  Edouard Julien            |     Low Data    |      0.02%      |      12/100
  Alan Roden                |      0.01%      |      0.14%      |      51/100

========================================================================================================================
GAME: Giants @ Pirates (6:40 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Pirates Batters vs. Justin Verlander (Last 90d: 241 PA | 14.1% K | 8.7% BB | 21 BB | 2.5% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Oneil Cruz                |      1.88%      |      0.06%      |      5/100
  Nick Gonzales             |      0.82%      |      0.03%      |      7/100
  Spencer Horwitz           |      0.40%      |      0.00%      |      31/100
  Andrew McCutchen          |      0.31%      |      0.03%      |      41/100
  Jared Triolo              |      0.23%      |      0.01%      |      9/100
  Tommy Pham                |      0.11%      |      0.02%      |      20/100
  Henry Davis               |      0.05%      |      0.00%      |      11/100
  Bryan Reynolds            |      0.03%      |      0.00%      |      11/100
  Isiah Kiner-Falefa        |      0.01%      |      0.00%      |      4/100

------------------------------------------------------------------------------------------------------------------------
  Giants Batters vs. Johan Oviedo (Low Data)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Heliot Ramos              |     Low Data    |      0.98%      |     Low Data
  Rafael Devers             |     Low Data    |      0.61%      |     Low Data
  Willy Adames              |     Low Data    |      59.71%     |     Low Data
  Matt Chapman              |     Low Data    |      0.15%      |     Low Data
  Jung Hoo Lee              |     Low Data    |      0.60%      |     Low Data
  Wilmer Flores             |     Low Data    |      1.17%      |     Low Data
  Casey Schmitt             |     Low Data    |      0.12%      |     Low Data
  Patrick Bailey            |     Low Data    |      0.08%      |     Low Data
  Grant McCray              |     Low Data    |      2.64%      |     Low Data

========================================================================================================================
GAME: Astros @ Marlins (6:40 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Marlins Batters vs. Jason Alexander (Last 90d: 107 PA | 14.0% K | 12.1% BB | 13 BB | 4.7% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Liam Hicks                |      0.23%      |      0.18%      |      41/100
  Otto Lopez                |      0.08%      |      0.32%      |      57/100
  Graham Pauley             |      0.02%      |      0.80%      |      14/100
  Kyle Stowers              |      0.02%      |      0.13%      |      38/100
  Xavier Edwards            |      0.01%      |      0.43%      |      44/100
  Agustín Ramírez           |      0.01%      |      0.03%      |      53/100
  Dane Myers                |      0.00%      |      0.02%      |      21/100

------------------------------------------------------------------------------------------------------------------------
  Astros Batters vs. Sandy Alcántara (Last 90d: 361 PA | 15.8% K | 6.9% BB | 25 BB | 2.5% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Mauricio Dubón            |      0.02%      |      0.00%      |      26/100
  Yainer Diaz               |      0.00%      |      0.00%      |      39/100
  Taylor Trammell           |      0.00%      |      0.01%      |      35/100
  Carlos Correa             |      0.00%      |      0.00%      |      31/100
  José Altuve               |      0.00%      |      0.01%      |      6/100
  Christian Walker          |      0.00%      |      0.00%      |      25/100
  Jeremy Peña               |      0.00%      |      0.00%      |      40/100
  Cam Smith                 |      0.00%      |      0.01%      |      42/100
  T. J. McFarland           |     Low Data    |     Low Data    |     Low Data

========================================================================================================================
GAME: Orioles @ Phillies (6:45 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Phillies Batters vs. Cade Povich (Last 90d: 152 PA | 20.4% K | 7.2% BB | 11 BB | 2.6% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Otto Kemp                 |      3.06%      |      0.02%      |      7/100
  Harrison Bader            |      1.76%      |      0.00%      |      22/100
  Edmundo Sosa              |      0.87%      |      0.00%      |      17/100
  Bryce Harper              |      0.41%      |      0.00%      |      28/100
  Trea Turner               |      0.31%      |      0.00%      |      8/100
  Nick Castellanos          |      0.15%      |      0.00%      |      12/100
  Kyle Schwarber            |      0.08%      |      0.00%      |      4/100
  Brandon Marsh             |      0.06%      |      0.01%      |      8/100
  J. T. Realmuto            |      0.00%      |      0.00%      |      4/100

------------------------------------------------------------------------------------------------------------------------
  Orioles Batters vs. Jesús Luzardo (Last 90d: 349 PA | 21.2% K | 9.5% BB | 33 BB | 2.6% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Colton Cowser             |      0.23%      |      0.03%      |      28/100
  Jackson Holliday          |      0.11%      |      0.04%      |      26/100
  Gunnar Henderson          |      0.06%      |      0.04%      |      10/100
  Adley Rutschman           |      0.00%      |      0.00%      |      14/100
  Tyler O'Neill             |      0.00%      |      0.00%      |      22/100
  Dylan Carlson             |      0.00%      |      0.12%      |      9/100
  Coby Mayo                 |      0.00%      |      0.18%      |      24/100
  Jordan Westburg           |      0.00%      |      0.00%      |      22/100

========================================================================================================================
GAME: Royals @ Red Sox (7:10 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Red Sox Batters vs. Bailey Falter (Last 90d: 307 PA | 10.1% K | 9.1% BB | 28 BB | 3.6% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Roman Anthony             |      0.05%      |      0.75%      |      29/100
  Jarren Duran              |      0.01%      |      0.02%      |      24/100
  Abraham Toro              |      0.01%      |      1.02%      |      33/100
  Alex Bregman              |      0.00%      |      0.00%      |      32/100
  Romy Gonzalez             |      0.00%      |      0.00%      |      27/100
  Ceddanne Rafaela          |      0.00%      |      0.00%      |      26/100
  Rob Refsnyder             |      0.00%      |      0.00%      |      30/100
  Carlos Narváez            |      0.00%      |      0.00%      |      50/100
  Trevor Story              |      0.00%      |      0.00%      |      42/100

------------------------------------------------------------------------------------------------------------------------
  Royals Batters vs. Brayan Bello (Last 90d: 394 PA | 14.0% K | 8.6% BB | 34 BB | 2.3% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Bobby Witt                |      0.01%      |      0.14%      |      2/100
  Salvador Pérez            |      0.00%      |      0.72%      |      2/100
  Maikel García             |      0.00%      |      0.00%      |      2/100
  Vinnie Pasquantino        |      0.00%      |      0.06%      |      24/100
  Kyle Isbel                |      0.00%      |      0.01%      |      11/100
  Adam Frazier              |      0.00%      |      0.05%      |      10/100
  Mike Yastrzemski          |      0.00%      |      0.12%      |      24/100
  Jonathan India            |      0.00%      |      0.02%      |      25/100
  Randal Grichuk            |      0.00%      |      0.02%      |      5/100

========================================================================================================================
GAME: Guardians @ Mets (7:10 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Mets Batters vs. Slade Cecconi (Last 90d: 314 PA | 13.1% K | 6.7% BB | 21 BB | 4.1% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Francisco Lindor          |      82.28%     |      0.46%      |      39/100
  Jeff McNeil               |      59.53%     |      0.01%      |      21/100
  Pete Alonso               |      54.15%     |      63.62%     |      53/100
  Cedric Mullins            |      0.55%      |      0.04%      |      57/100
  Mark Vientos              |      0.39%      |      0.01%      |      23/100
  Brandon Nimmo             |      0.30%      |      0.17%      |      72/100
  Ronny Mauricio            |      0.15%      |      0.00%      |      40/100
  Juan Soto                 |      0.03%      |      3.24%      |      8/100
  Francisco Álvarez         |      0.02%      |      0.00%      |      2/100

------------------------------------------------------------------------------------------------------------------------
  Guardians Batters vs. Sean Manaea (Last 90d: 68 PA | 27.9% K | 5.9% BB | 4 BB | 2.9% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  David Fry                 |      0.04%      |      0.00%      |      2/100
  Carlos Santana            |      0.01%      |      0.01%      |      4/100
  Daniel Schneemann         |      0.01%      |      1.71%      |      5/100
  Brayan Rocchio            |      0.01%      |      0.23%      |      4/100
  Austin Hedges             |      0.01%      |      0.19%      |      4/100
  Steven Kwan               |      0.01%      |      0.39%      |      3/100
  Gabriel Arias             |      0.01%      |      0.05%      |      2/100
  Angel Martínez            |      0.00%      |      0.06%      |      4/100
  José Ramírez              |      0.00%      |      0.08%      |      3/100

========================================================================================================================
GAME: Brewers @ Braves (7:15 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Braves Batters vs. Quinn Priester (Last 90d: 338 PA | 12.1% K | 5.9% BB | 20 BB | 2.7% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Austin Riley              |      0.06%      |      0.01%      |      28/100
  Ozzie Albies              |      0.05%      |      0.04%      |      24/100
  Nick Allen                |      0.01%      |      0.37%      |      15/100
  Drake Baldwin             |      0.00%      |      0.10%      |      34/100
  Jurickson Profar          |      0.00%      |      1.12%      |      21/100
  Michael Harris            |      0.00%      |      10.23%     |      9/100
  Eli White                 |      0.00%      |      0.02%      |      17/100
  Sean Murphy               |      0.00%      |      0.00%      |      17/100
  Matt Olson                |      0.00%      |      0.96%      |      14/100

------------------------------------------------------------------------------------------------------------------------
  Brewers Batters vs. Erick Fedde (Last 90d: 332 PA | 12.7% K | 9.3% BB | 31 BB | 3.6% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Christian Yelich          |      0.27%      |      0.00%      |      42/100
  Brice Turang              |      0.27%      |      0.00%      |      57/100
  Andrew Vaughn             |      0.13%      |      0.02%      |      38/100
  Sal Frelick               |      0.03%      |      0.00%      |      27/100
  Isaac Collins             |      0.01%      |      0.17%      |      35/100
  Blake Perkins             |      0.01%      |      0.09%      |      7/100
  William Contreras         |      0.00%      |      0.01%      |      36/100
  Joey Ortiz                |      0.00%      |      0.01%      |      28/100
  Caleb Durbin              |      0.00%      |      0.07%      |      21/100

========================================================================================================================
GAME: Yankees @ Rangers (8:05 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Rangers Batters vs. Max Fried (Last 90d: 361 PA | 17.7% K | 5.8% BB | 21 BB | 2.2% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Corey Seager              |      0.02%      |      0.07%      |      35/100
  Sam Haggerty              |      0.01%      |      1.07%      |      61/100
  Ezequiel Duran            |      0.01%      |      1.08%      |      13/100
  Wyatt Langford            |      0.00%      |      0.01%      |      47/100
  Jonah Heim                |      0.00%      |      0.01%      |      30/100
  Kyle Higashioka           |      0.00%      |      0.00%      |      31/100
  Josh Jung                 |      0.00%      |      0.03%      |      38/100
  Adolis García             |      0.00%      |      0.03%      |      28/100
  Marcus Semien             |      0.00%      |      0.03%      |      31/100

------------------------------------------------------------------------------------------------------------------------
  Yankees Batters vs. Patrick Corbin (Last 90d: 353 PA | 17.3% K | 6.8% BB | 24 BB | 2.8% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Ben Rice                  |      10.95%     |      0.14%      |     100/100
  Cody Bellinger            |      4.93%      |      3.61%      |      37/100
  Trent Grisham             |      0.06%      |      0.04%      |      24/100
  Ryan McMahon              |      0.03%      |      0.08%      |      31/100
  Jazz Chisholm             |      0.01%      |      4.82%      |      41/100
  Austin Slater             |      0.00%      |      0.02%      |     100/100
  Paul Goldschmidt          |      0.00%      |      0.00%      |      31/100
  Anthony Volpe             |      0.00%      |      0.02%      |      34/100
  Giancarlo Stanton         |      0.00%      |      0.00%      |      20/100

========================================================================================================================
GAME: Reds @ Cubs (8:05 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Cubs Batters vs. Nick Lodolo (Last 90d: 348 PA | 21.8% K | 4.9% BB | 17 BB | 3.4% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Pete Crow-Armstrong       |      1.01%      |      0.04%      |      10/100
  Kyle Tucker               |      0.55%      |      0.21%      |      32/100
  Justin Turner             |      0.01%      |      0.01%      |      51/100
  Seiya Suzuki              |      0.01%      |      0.00%      |      12/100
  Nico Hoerner              |      0.01%      |      0.04%      |      22/100
  Ian Happ                  |      0.00%      |      0.00%      |      26/100
  Carson Kelly              |      0.00%      |      0.02%      |      48/100
  Dansby Swanson            |      0.00%      |      0.00%      |      18/100
  Matt Shaw                 |      0.00%      |      0.00%      |      60/100

------------------------------------------------------------------------------------------------------------------------
  Reds Batters vs. Michael Soroka (Last 90d: 325 PA | 15.4% K | 7.1% BB | 23 BB | 3.1% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Spencer Steer             |      1.68%      |      0.01%      |      39/100
  Tyler Stephenson          |      0.15%      |      0.04%      |      28/100
  Matt McLain               |      0.09%      |      0.00%      |      17/100
  Ke'Bryan Hayes            |      0.02%      |      0.00%      |      11/100
  TJ Friedl                 |      0.02%      |      0.01%      |      24/100
  Austin Hays               |      0.02%      |      0.09%      |      34/100
  Elly De La Cruz           |      0.00%      |      0.01%      |      28/100
  Gavin Lux                 |      0.00%      |      0.03%      |      22/100
  Jake Fraley               |      0.00%      |      0.01%      |      7/100

========================================================================================================================
GAME: Blue Jays @ Rockies (8:40 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Rockies Batters vs. Eric Lauer (Last 90d: 274 PA | 21.2% K | 5.5% BB | 15 BB | 2.9% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Kyle Farmer               |      0.01%      |      0.01%      |      13/100
  Tyler Freeman             |      0.01%      |      0.12%      |      7/100
  Hunter Goodman            |      0.01%      |      0.00%      |      30/100
  Thairo Estrada            |      0.00%      |      0.11%      |      38/100
  Jordan Beck               |      0.00%      |      0.05%      |      28/100
  Orlando Arcia             |      0.00%      |      0.00%      |      12/100
  Brenton Doyle             |      0.00%      |      0.01%      |      19/100
  Warming Bernabel          |     Low Data    |     Low Data    |      3/100
  Ezequiel Tovar            |      0.00%      |      0.00%      |      18/100

------------------------------------------------------------------------------------------------------------------------
  Blue Jays Batters vs. Tanner Gordon (Last 90d: 114 PA | 9.6% K | 7.0% BB | 8 BB | 2.6% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Joey Loperfido            |      83.41%     |      0.06%      |      8/100
  Addison Barger            |      50.72%     |      0.01%      |      8/100
  Daulton Varsho            |      10.22%     |      0.00%      |      3/100
  Nathan Lukes              |      2.63%      |      0.02%      |      9/100
  Alejandro Kirk            |      0.74%      |      0.07%      |      7/100
  Ernie Clement             |      0.10%      |      0.23%      |      4/100
  Vladimir Guerrero         |      0.05%      |      0.07%      |      2/100
  Bo Bichette               |      0.03%      |      0.02%      |      4/100
  Ty France                 |      0.02%      |      0.08%      |      7/100

========================================================================================================================
GAME: Rays @ Angels (9:38 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Angels Batters vs. Adrian Houser (Last 90d: 278 PA | 14.0% K | 7.9% BB | 22 BB | 1.1% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Gustavo Campero           |      0.13%      |      0.52%      |      10/100
  Logan O'Hoppe             |      0.01%      |      0.01%      |      7/100
  Taylor Ward               |      0.01%      |      0.00%      |      5/100
  Zach Neto                 |      0.01%      |      0.03%      |      8/100
  Jo Adell                  |      0.01%      |      0.02%      |      7/100
  Mike Trout                |      0.00%      |      0.01%      |      5/100
  Nolan Schanuel            |      0.00%      |      0.15%      |      20/100
  Christian Moore           |      0.00%      |      0.19%      |      3/100
  Yoán Moncada              |      0.00%      |      0.03%      |      5/100

------------------------------------------------------------------------------------------------------------------------
  Rays Batters vs. Yusei Kikuchi (Last 90d: 388 PA | 19.8% K | 8.2% BB | 32 BB | 2.8% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Brandon Lowe              |      9.61%      |      0.00%      |      34/100
  Josh Lowe                 |      1.32%      |      0.17%      |      50/100
  Ha-Seong Kim              |      0.01%      |      0.27%      |      16/100
  Jonny DeLuca              |      0.01%      |      0.22%      |      15/100
  Nick Fortes               |      0.01%      |      0.29%      |      25/100
  Jake Mangum               |      0.01%      |      1.10%      |      27/100
  Yandy Díaz                |      0.00%      |      0.00%      |      26/100
  Junior Caminero           |      0.00%      |      0.00%      |      56/100
  Christopher Morel         |      0.00%      |      0.00%      |      32/100

========================================================================================================================
GAME: Padres @ Diamondbacks (9:40 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Diamondbacks Batters vs. JP Sears (Last 90d: 336 PA | 17.0% K | 6.8% BB | 23 BB | 5.7% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Ketel Marte               |      7.37%      |      0.00%      |      25/100
  Corbin Carroll            |      1.23%      |      0.00%      |      28/100
  Geraldo Perdomo           |      0.60%      |      0.04%      |      38/100
  Jake McCarthy             |      0.01%      |      1.09%      |      28/100
  Blaze Alexander           |      0.01%      |      0.01%      |      32/100
  Jorge Barrosa             |     Low Data    |      1.10%      |      10/100
  Tyler Locklear            |     Low Data    |      0.00%      |      1/100
  José Herrera              |      0.01%      |      1.08%      |      50/100
  Lourdes Gurriel           |      0.00%      |      0.00%      |      22/100

------------------------------------------------------------------------------------------------------------------------
  Padres Batters vs. Brandon Pfaadt (Last 90d: 336 PA | 14.9% K | 5.4% BB | 18 BB | 3.9% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Manny Machado             |      1.12%      |      0.00%      |      39/100
  Ramón Laureano            |      0.71%      |      0.00%      |      45/100
  Xander Bogaerts           |      0.33%      |      0.00%      |      61/100
  Fernando Tatís            |      0.06%      |      0.05%      |      83/100
  Jackson Merrill           |      0.01%      |      0.00%      |      44/100
  Luis Arráez               |      0.01%      |      0.02%      |      65/100
  Freddy Fermin             |      0.00%      |      0.02%      |      37/100
  Jake Cronenworth          |      0.00%      |      0.03%      |      35/100
  Ryan O'Hearn              |      0.00%      |      0.02%      |      42/100

========================================================================================================================
GAME: Cardinals @ Dodgers (10:10 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Dodgers Batters vs. Sonny Gray (Last 90d: 343 PA | 12.8% K | 2.9% BB | 10 BB | 2.6% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Will Smith                |      66.02%     |      0.00%      |      22/100
  Andy Pages                |      54.11%     |      0.00%      |      64/100
  Freddie Freeman           |      5.70%      |      0.02%      |      39/100
  Teoscar Hernández         |      3.25%      |      0.83%      |      30/100
  Mookie Betts              |      0.13%      |      0.01%      |      41/100
  Michael Conforto          |      0.12%      |      0.01%      |      35/100
  Shohei Ohtani             |      0.06%      |      0.00%      |      74/100
  Miguel Rojas              |      0.05%      |      0.04%      |      28/100
  Max Muncy                 |      0.01%      |      0.01%      |     Low Data

------------------------------------------------------------------------------------------------------------------------
  Cardinals Batters vs. Tyler Glasnow (Last 90d: 88 PA | 26.1% K | 11.4% BB | 10 BB | 3.4% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Alec Burleson             |      5.53%      |      0.01%      |      10/100
  Lars Nootbaar             |      1.17%      |      0.03%      |      13/100
  Brendan Donovan           |      0.44%      |      0.01%      |      27/100
  Nolan Gorman              |      0.29%      |      0.01%      |      12/100
  Iván Herrera              |      0.02%      |      0.05%      |      11/100
  Yohel Pozo                |      0.02%      |      0.07%      |      8/100
  Masyn Winn                |      0.00%      |      0.05%      |      29/100
  Victor Scott              |      0.00%      |      0.01%      |      6/100
  Willson Contreras         |      0.00%      |      0.02%      |      5/100

========================================================================================================================
        `;

        /**
         * Parses the "TOP 10 PICKS" section of the report.
         */
        function parseTopPicks(text) {
            const topPicks = [];
            const topPicksRegex = /--- TOP 10 PICKS OF THE DAY \(90-Day Model\) ---\s*([\s\S]*?)\s*================/m;
            const match = text.match(topPicksRegex);

            if (match && match[1]) {
                const lines = match[1].trim().split('\n');
                // Start after the header and the two separator lines
                for (let i = 3; i < lines.length; i++) {
                    const line = lines[i];
                    const parts = line.split('|').map(p => p.trim());
                    if (parts.length === 7) {
                        topPicks.push({
                            rank: parts[0],
                            batter: parts[1],
                            pitcher: parts[2],
                            xgboost: parts[3],
                            lightgbm: parts[4],
                            catboost: parts[5],
                            finalScore: parts[6]
                        });
                    }
                }
            }
            return topPicks;
        }

        /**
         * Renders the "TOP 10 PICKS" into a collapsible accordion.
         */
        function renderTopPicks(topPicksData) {
            const container = document.getElementById('top-picks-container');
            if (!topPicksData || topPicksData.length === 0) {
                container.innerHTML = '';
                return;
            }

            let playersHtml = '';
            topPicksData.forEach(player => {
                playersHtml += `
                    <tr class="player-row">
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center">${player.rank}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm">${player.batter}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm">${player.pitcher}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center">${player.xgboost}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center">${player.lightgbm}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center">${player.catboost}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center font-semibold">${player.finalScore}</td>
                    </tr>
                `;
            });

            container.innerHTML = `
                <details class="top-picks-card rounded-lg shadow-md overflow-hidden border dark:border-gray-700">
                    <summary class="p-4 flex justify-center items-center relative bg-gray-800 text-white game-header">
                        <h2 class="text-lg font-bold text-center">TOP 10 PICKS OF THE DAY (90-Day Model)</h2>
                        <svg class="w-6 h-6 summary-chevron absolute right-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </summary>
                    <div class="p-4">
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white dark:bg-gray-800">
                                <thead class="table-header">
                                    <tr>
                                        <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Rank</th>
                                        <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Batter</th>
                                        <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Pitcher</th>
                                        <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">XGBoost</th>
                                        <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">LightGBM</th>
                                        <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">CatBoost</th>
                                        <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Final Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${playersHtml}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </details>
            `;
        }


        /**
         * Parses the game-by-game sections of the report.
         */
        function parseReport(text) {
            const games = [];
            const allBlocks = text.split(/={80,}/);
            const gameStartIndex = allBlocks.findIndex(b => b.trim().startsWith('GAME:'));
            
            if (gameStartIndex === -1) {
                console.error("No game blocks found in the report text.");
                return [];
            }

            const gameBlocks = allBlocks.slice(gameStartIndex);

            gameBlocks.forEach(block => {
                if (!block.trim()) return;

                const lines = block.trim().split('\n');
                const gameTitleLine = lines.find(line => line.startsWith('GAME:'));
                if (!gameTitleLine) return;
                
                const gameTitle = gameTitleLine.replace('GAME: ', '').trim();
                const teamSections = block.split(/-{80,}/).slice(1);
                const teamsData = [];

                teamSections.forEach((section, teamIndex) => {
                    const sectionLines = section.trim().split('\n');
                    if (sectionLines.length < 3) return;

                    let teamTitle = sectionLines[0].trim();
                    let pitcherStats = 'N/A';
                    const statsIndex = teamTitle.indexOf('(');
                    if (statsIndex > -1) {
                        pitcherStats = teamTitle.substring(statsIndex).replace('(', '').replace(')', '');
                        teamTitle = teamTitle.substring(0, statsIndex).trim();
                    }
                    
                    const players = [];
                    for (let i = 2; i < sectionLines.length; i++) {
                        const line = sectionLines[i];
                        if (!line.includes('|') || line.includes('---')) continue;

                        const parts = line.split('|').map(p => p.trim());
                        if (parts.length < 4) continue;

                        const name = parts[0];
                        const prob90DayStr = parts[1];
                        const prob2YearStr = parts[2];
                        const hrCompScoreStr = parts[3];
                        
                        const prob90DayValue = prob90DayStr.toLowerCase().includes('low data') ? -1 : parseFloat(prob90DayStr);
                        const prob2YearValue = prob2YearStr.toLowerCase().includes('low data') ? -1 : parseFloat(prob2YearStr);
                        const hrCompScoreValue = hrCompScoreStr.toLowerCase().includes('low data') ? -1 : parseInt(hrCompScoreStr);

                        const isHigh90Day = (prob90DayValue > 5);
                        const isHigh2Year = (prob2YearValue > 25);
                        const isHighCompScore = (hrCompScoreValue >= 50);

                        players.push({ name, prob90DayStr, prob2YearStr, hrCompScoreStr, prob90DayValue, prob2YearValue, hrCompScoreValue, isHigh90Day, isHigh2Year, isHighCompScore });
                    }
                    if (players.length > 0) {
                        const hasHigh90Day = players.some(p => p.isHigh90Day);
                        const hasHigh2Year = players.some(p => p.isHigh2Year);
                        const hasHighCompScore = players.some(p => p.isHighCompScore);
                        teamsData.push({ id: `${gameTitle}-${teamIndex}`, title: teamTitle, pitcherStats, players, hasHigh90Day, hasHigh2Year, hasHighCompScore });
                    }
                });
                
                if (teamsData.length > 0) {
                    const gameHasHigh90Day = teamsData.some(t => t.hasHigh90Day);
                    const gameHasHigh2Year = teamsData.some(t => t.hasHigh2Year);
                    const gameHasHighCompScore = teamsData.some(t => t.hasHighCompScore);
                    games.push({ title: gameTitle, teams: teamsData, hasHigh90Day: gameHasHigh90Day, hasHigh2Year: gameHasHigh2Year, hasHighCompScore: gameHasHighCompScore });
                }
            });

            return games;
        }

        /**
         * Renders the parsed game data into HTML cards.
         */
        function renderReport(gamesData) {
            const container = document.getElementById('report-container');
            container.innerHTML = ''; 

            if (!gamesData || gamesData.length === 0) return;

            gamesData.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'card border overflow-hidden rounded-lg shadow-md transition-all duration-300';
                
                gameCard.dataset.hasHigh90day = game.hasHigh90Day;
                gameCard.dataset.hasHigh2year = game.hasHigh2Year;
                gameCard.dataset.hasHighCompscore = game.hasHighCompScore;

                const teamsHtml = game.teams.map(team => {
                    const playersHtml = team.players.map(player => `
                        <tr class="player-row" 
                            data-filter-90day="${player.isHigh90Day}" 
                            data-filter-2year="${player.isHigh2Year}" 
                            data-filter-compscore="${player.isHighCompScore}">
                            <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm player-name">${player.name}</td>
                            <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob90DayStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob90DayStr}</td>
                            <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob2YearStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob2YearStr}</td>
                            <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.hrCompScoreStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.hrCompScoreStr}</td>
                        </tr>
                    `).join('');
                    
                    return `
                        <div class="p-4" data-team-id="${team.id}">
                            <details class="mb-2">
                                <summary class="font-semibold text-gray-700 dark:text-gray-300 text-md mb-2 flex justify-between items-center">
                                    <span>${team.title}</span>
                                    <svg class="w-5 h-5 summary-chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                                </summary>
                                <div class="text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-2 rounded-md mt-2">
                                    ${team.pitcherStats}
                                </div>
                            </details>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white dark:bg-gray-800">
                                    <thead class="table-header">
                                        <tr>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Batter</th>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider sortable" data-sort-key="prob90DayValue">90-Day Prob</th>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider sortable" data-sort-key="prob2YearValue">2-Year Prob</th>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider sortable" data-sort-key="hrCompScoreValue">HR SIMILARITY</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${playersHtml}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }).join('');

                gameCard.innerHTML = `
                    <div class="bg-gray-800 text-white p-4 game-header">
                        <h2 class="font-bold text-lg">${game.title}</h2>
                    </div>
                    <div class="divide-y divide-gray-200 dark:divide-gray-700">
                        ${teamsHtml}
                    </div>
                `;
                container.appendChild(gameCard);
            });
        }
        
        /**
         * Sorts a specific team's player list and re-renders that table.
         */
        function sortTeam(teamId, sortKey) {
            const teamData = allGamesData.flatMap(g => g.teams).find(t => t.id === teamId);
            if (!teamData) return;

            const order = (currentSort.key === sortKey && currentSort.order === 'desc') ? 'asc' : 'desc';
            currentSort = { key: sortKey, order };

            teamData.players.sort((a, b) => {
                const valA = a[sortKey];
                const valB = b[sortKey];

                if (valA === -1 && valB !== -1) return 1;
                if (valB === -1 && valA !== -1) return -1;
                
                return order === 'desc' ? valB - valA : valA - valB;
            });

            const teamContainer = document.querySelector(`[data-team-id="${teamId}"]`);
            if (!teamContainer) return;

            const tableHeaders = teamContainer.querySelectorAll('th.sortable');
            tableHeaders.forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.dataset.sortKey === sortKey) {
                    th.classList.add(order === 'desc' ? 'sort-desc' : 'sort-asc');
                }
            });

            const tableBody = teamContainer.querySelector('tbody');
            const playersHtml = teamData.players.map(player => `
                 <tr class="player-row" 
                    data-filter-90day="${player.isHigh90Day}" 
                    data-filter-2year="${player.isHigh2Year}" 
                    data-filter-compscore="${player.isHighCompScore}">
                    <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm player-name">${player.name}</td>
                    <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob90DayStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob90DayStr}</td>
                    <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob2YearStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob2YearStr}</td>
                    <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.hrCompScoreStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.hrCompScoreStr}</td>
                </tr>
            `).join('');

            tableBody.innerHTML = playersHtml;
            applyFilter();
        }

        /**
         * Applies the active filter to the report.
         * THIS FUNCTION HAS BEEN REWRITTEN FOR CORRECTNESS.
         */
        function applyFilter() {
            const gameCards = document.querySelectorAll('#report-container .card');
            const noDataMessage = document.getElementById('no-data-message');
            const toggle90dayBtn = document.getElementById('toggle-90day-btn');
            const toggle2yearBtn = document.getElementById('toggle-2year-btn');
            const toggleCompscoreBtn = document.getElementById('toggle-compscore-btn');

            let totalVisibleCards = 0;

            // Determine which data attribute to check based on the active filter
            let filterAttributeName = '';
            let highlightClass = '';

            if (activeFilter === '90day') {
                filterAttributeName = 'data-filter-90day';
                highlightClass = 'highlight';
            }
            if (activeFilter === '2year') {
                filterAttributeName = 'data-filter-2year';
                highlightClass = 'two-year-highlight';
            }
            if (activeFilter === 'compscore') {
                filterAttributeName = 'data-filter-compscore';
                highlightClass = 'sim-highlight';
            }

            // Loop through each game card
            gameCards.forEach(card => {
                const playerRows = card.querySelectorAll('.player-row');
                let cardHasAVisiblePlayer = false;

                // Loop through each player in the card
                playerRows.forEach(row => {
                    // Reset styles first
                    row.classList.remove('highlight', 'two-year-highlight', 'sim-highlight');
                    
                    // If no filter is active, everyone is visible
                    if (activeFilter === 'none') {
                        row.style.display = 'table-row';
                        cardHasAVisiblePlayer = true;
                    } else {
                        // If a filter is active, check if this player matches using getAttribute
                        if (row.getAttribute(filterAttributeName) === 'true') {
                            row.style.display = 'table-row';
                            row.classList.add(highlightClass);
                            cardHasAVisiblePlayer = true;
                        } else {
                            row.style.display = 'none';
                        }
                    }
                });

                // Now, show or hide the entire card based on whether it has any visible players
                if (cardHasAVisiblePlayer) {
                    card.style.display = 'block';
                    totalVisibleCards++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Update "No data" message
            noDataMessage.classList.toggle('hidden', totalVisibleCards > 0 || activeFilter === 'none');

            // Update button styles
            toggle90dayBtn.classList.toggle('bg-green-600', activeFilter === '90day');
            toggle90dayBtn.classList.toggle('hover:bg-green-700', activeFilter === '90day');
            toggle90dayBtn.classList.toggle('bg-blue-600', activeFilter !== '90day');
            toggle90dayBtn.classList.toggle('hover:bg-blue-700', activeFilter !== '90day');

            toggle2yearBtn.classList.toggle('bg-green-600', activeFilter === '2year');
            toggle2yearBtn.classList.toggle('hover:bg-green-700', activeFilter === '2year');
            toggle2yearBtn.classList.toggle('bg-blue-600', activeFilter !== '2year');
            toggle2yearBtn.classList.toggle('hover:bg-blue-700', activeFilter !== '2year');

            toggleCompscoreBtn.classList.toggle('bg-green-600', activeFilter === 'compscore');
            toggleCompscoreBtn.classList.toggle('hover:bg-green-700', activeFilter === 'compscore');
            toggleCompscoreBtn.classList.toggle('bg-blue-600', activeFilter !== 'compscore');
            toggleCompscoreBtn.classList.toggle('hover:bg-blue-700', activeFilter !== 'compscore');
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
            const yepButton = document.getElementById('yep-button');
            const toggle90dayBtn = document.getElementById('toggle-90day-btn');
            const toggle2yearBtn = document.getElementById('toggle-2year-btn');
            const toggleCompscoreBtn = document.getElementById('toggle-compscore-btn');
            const zxmButton = document.getElementById('zxm-button');

            if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                themeToggleLightIcon.classList.remove('hidden');
            } else {
                themeToggleDarkIcon.classList.remove('hidden');
            }

            themeToggleBtn.addEventListener('click', function() {
                themeToggleDarkIcon.classList.toggle('hidden');
                themeToggleLightIcon.classList.toggle('hidden');
                document.documentElement.classList.toggle('dark');
                const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                localStorage.setItem('color-theme', theme);
            });

            // Parse and Render all data from the text block on load
            const topPicksData = parseTopPicks(reportText);
            allGamesData = parseReport(reportText);
            
            renderTopPicks(topPicksData);
            renderReport(allGamesData);
            
            toggle90dayBtn.addEventListener('click', () => {
                activeFilter = (activeFilter === '90day') ? 'none' : '90day';
                applyFilter();
            });

            toggle2yearBtn.addEventListener('click', () => {
                activeFilter = (activeFilter === '2year') ? 'none' : '2year';
                applyFilter();
            });

            toggleCompscoreBtn.addEventListener('click', () => {
                activeFilter = (activeFilter === 'compscore') ? 'none' : 'compscore';
                applyFilter();
            });

            yepButton.addEventListener('click', function() {
                this.textContent = 'I THOUGHT SO';
                window.open('https://docs.google.com/document/d/1aKu86WYVzp6PYmPakztiz3pTwVMY-sPB85jJ4bvf8AI/edit?usp=sharing', '_blank');
            });
            
            zxmButton.addEventListener('click', function() {
                window.open('https://x.com/Zxmbuu', '_blank');
            });

            const container = document.getElementById('report-container');
            container.addEventListener('click', (e) => {
                const header = e.target.closest('.sortable');
                if (header) {
                    const sortKey = header.dataset.sortKey;
                    const teamContainer = header.closest('[data-team-id]');
                    if (teamContainer) {
                        const teamId = teamContainer.dataset.teamId;
                        sortTeam(teamId, sortKey);
                    }
                }
            });
        });
    </script>
</body>
</html>
