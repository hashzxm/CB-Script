<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Run Prediction Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-800 */
            transition: background-color 0.3s, color 0.3s;
        }
        .dark body {
            background-color: #111827; /* gray-900 */
            color: #d1d5db; /* gray-300 */
        }
        .card {
            background-color: white;
            border-color: #e5e7eb; /* gray-200 */
        }
        .dark .card {
            background-color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .dark .card:hover {
             box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4);
        }
        .highlight {
            background-color: #d1fae5; /* green-200 */
        }
        .dark .highlight {
            background-color: #064e3b; /* green-900 */
        }
        .highlight .player-name {
            color: #065f46; /* green-800 */
            font-weight: 600;
        }
        .dark .highlight .player-name {
            color: #a7f3d0; /* green-300 */
        }
        .low-data {
            color: #6b7280; /* gray-500 */
            font-style: italic;
        }
        .dark .low-data {
            color: #9ca3af; /* gray-400 */
        }
        .table-header th {
            background-color: #f9fafb; /* gray-50 */
        }
        .dark .table-header th {
            background-color: #374151; /* gray-700 */
            color: #d1d5db; /* gray-300 */
        }
        .player-row:hover {
            background-color: #f9fafb; /* gray-50 */
        }
        .dark .player-row:hover {
            background-color: #374151; /* gray-700 */
        }
        .toggle-btn {
            transition: background-color 0.3s, color 0.3s;
        }
        .sortable {
            cursor: pointer;
            user-select: none;
        }
        .sortable:hover {
            background-color: #e5e7eb; /* gray-200 */
        }
        .dark .sortable:hover {
            background-color: #4b5563; /* gray-600 */
        }
        .sort-asc::after { content: ' ▲'; font-size: 0.7em; }
        .sort-desc::after { content: ' ▼'; font-size: 0.7em; }
        
        .dark .game-header { background-color: #374151; }
        .dark .text-gray-800 { color: #f9fafb; }
        .dark .text-gray-600 { color: #9ca3af; }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Home Run Prediction Report</h1>
            <p class="text-gray-600 mt-2">August 2, 2025</p>
            <div class="flex justify-center items-center space-x-4 mt-6">
                <button id="toggle-highlight-btn" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 toggle-btn">
                    Toggle High Probability Players
                </button>
                <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                    <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
            </div>
        </header>

        <main id="report-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Game cards will be injected here by JavaScript -->
        </main>
        
        <div id="no-data-message" class="hidden text-center py-16">
            <p class="text-xl text-gray-500">No high probability players found.</p>
        </div>

    </div>
    
    <footer class="mt-12 text-center">
        <iframe src="https://giphy.com/embed/krkrHAEodHgzP72rTI" width="480" height="269" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/disneyplus-krkrHAEodHgzP72rTI" class="text-xs text-gray-500 dark:text-gray-400">via GIPHY</a></p>
    </footer>

    <script>
        // Store the parsed data globally to avoid re-parsing
        let allGamesData = [];
        let currentSort = { key: null, order: 'desc' };

        // Raw text data from the new report
        const reportText = `
========================================================================================================================
                                       HOME RUN PREDICTION REPORT FOR 2025-08-02
========================================================================================================================
GAME: Braves @ Reds (7:15 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Reds Batters vs. Spencer Strider (Last 90d: 307 PA | 27.7% K | 10.1% BB | 31 BB | 2.9% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Austin Hays               |      51.49%     |      38.36%     |      15/100
  Tyler Stephenson          |      31.06%     |      63.67%     |      8/100
  Elly De La Cruz           |      1.63%      |      78.83%     |      23/100
  Spencer Steer             |      1.55%      |      88.31%     |      32/100
  Noelvi Marte              |      0.31%      |      58.74%     |      11/100
  Matt McLain               |      0.28%      |      38.64%     |      21/100
  Gavin Lux                 |      0.05%      |      55.04%     |      15/100
  TJ Friedl                 |      0.01%      |      86.87%     |      7/100

------------------------------------------------------------------------------------------------------------------------
  Braves Batters vs. Chase Burns (Last 90d: 127 PA | 35.4% K | 9.4% BB | 12 BB | 3.1% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Jurickson Profar          |      75.76%     |      3.80%      |      8/100
  Drake Baldwin             |      66.17%     |      37.34%     |      33/100
  Sean Murphy               |      0.59%      |      43.58%     |      11/100
  Ozzie Albies              |      0.23%      |      1.07%      |      10/100
  Eli White                 |      0.14%      |      0.31%      |      3/100
  Austin Riley              |      0.02%      |      30.27%     |      26/100
  Matt Olson                |      0.01%      |      1.93%      |      22/100
  Michael Harris            |      0.00%      |      0.49%      |      6/100

========================================================================================================================
GAME: Diamondbacks @ Athletics (10:05 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Athletics Batters vs. Zac Gallen (Last 90d: 382 PA | 20.4% K | 7.3% BB | 28 BB | 4.5% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Tyler Soderstrom          |      21.90%     |      62.38%     |      51/100
  Shea Langeliers           |      10.12%     |      84.75%     |      31/100
  Lawrence Butler           |      0.52%      |      84.47%     |      63/100
  Nick Kurtz                |      0.24%      |      1.53%      |      6/100
  Darell Hernaiz            |      0.08%      |      6.34%      |      7/100
  Brent Rooker              |      0.05%      |      82.64%     |      37/100
  Luis Urías                |      0.03%      |      78.55%     |      36/100
  Gio Urshela               |      0.00%      |      10.40%     |      28/100

------------------------------------------------------------------------------------------------------------------------
  Diamondbacks Batters vs. J. T. Ginn (Last 90d: 117 PA | 27.4% K | 2.6% BB | 3 BB | 4.3% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Lourdes Gurriel           |      93.49%     |      33.06%     |      28/100
  James McCann              |      4.59%      |      21.37%     |      4/100
  Ketel Marte               |      2.06%      |      27.48%     |      5/100
  Corbin Carroll            |      1.15%      |      18.24%     |      4/100
  Alek Thomas               |      0.86%      |      45.31%     |      11/100
  Adrian Del Castillo       |      0.48%      |      4.92%      |      3/100
  Blaze Alexander           |      0.10%      |      6.84%      |      3/100
  Geraldo Perdomo           |      0.07%      |      5.15%      |      29/100

========================================================================================================================
GAME: White Sox @ Angels (10:07 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Angels Batters vs. Aaron Civale (Last 90d: 261 PA | 17.6% K | 8.4% BB | 22 BB | 2.7% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Taylor Ward               |      94.39%     |      86.41%     |      17/100
  Mike Trout                |      82.26%     |      92.96%     |      10/100
  Jo Adell                  |      77.35%     |      72.07%     |      35/100
  Yoán Moncada              |      50.04%     |      3.07%      |      27/100
  Zach Neto                 |      37.21%     |      57.94%     |      14/100
  Logan O'Hoppe             |      3.30%      |      79.63%     |      9/100
  LaMonte Wade              |      0.22%      |      85.17%     |      23/100
  Luis Rengifo              |      0.11%      |      98.12%     |      34/100
  Nolan Schanuel            |      0.01%      |      71.73%     |      25/100

------------------------------------------------------------------------------------------------------------------------
  White Sox Batters vs. Kyle Hendricks (Last 90d: 350 PA | 16.3% K | 3.1% BB | 11 BB | 4.0% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Lenyn Sosa                |      77.88%     |      4.42%      |      37/100
  Brooks Baldwin            |      26.58%     |      84.87%     |      9/100
  Miguel Vargas             |      2.85%      |      17.40%     |      38/100
  Andrew Benintendi         |      0.42%      |      48.17%     |      39/100
  Mike Tauchman             |      0.05%      |      66.70%     |      23/100
  Chase Meidroth            |      0.02%      |      1.21%      |      50/100
  Colson Montgomery         |      0.01%      |      82.77%     |      15/100
  Luis Robert               |      0.01%      |      33.93%     |      14/100
  Kyle Teel                 |      0.00%      |      28.61%     |      33/100

========================================================================================================================
GAME: Cardinals @ Padres (10:10 PM ET)
------------------------------------------------------------------------------------------------------------------------
  Padres Batters vs. Michael McGreevy (Last 90d: 138 PA | 13.8% K | 3.6% BB | 5 BB | 1.4% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Xander Bogaerts           |      62.22%     |      5.55%      |      9/100
  Jake Cronenworth          |      0.99%      |      5.09%      |      13/100
  Manny Machado             |      0.52%      |      0.42%      |      29/100
  Jackson Merrill           |      0.15%      |      3.42%      |      14/100
  Fernando Tatís            |      0.10%      |      4.94%      |      12/100
  Luis Arráez               |      0.06%      |      0.63%      |      8/100
  Ramón Laureano            |      0.05%      |      4.77%      |      38/100
  Ryan O'Hearn              |      0.03%      |      6.98%      |      13/100

------------------------------------------------------------------------------------------------------------------------
  Cardinals Batters vs. Randy Vásquez (Last 90d: 325 PA | 12.6% K | 8.6% BB | 28 BB | 3.7% HR)
  Batter                    |   90-Day Prob   |   2-Year Prob   |  HR Comp Score
  ------------------------- | --------------- | --------------- | ---------------
  Alec Burleson             |      40.28%     |      82.57%     |      25/100
  Willson Contreras         |      33.28%     |      75.34%     |      38/100
  Nolan Gorman              |      2.33%      |      75.44%     |      18/100
  Brendan Donovan           |      0.23%      |      53.81%     |      52/100
  Iván Herrera              |      0.05%      |      6.82%      |      42/100
  Yohel Pozo                |      0.04%      |      4.24%      |      9/100
  Masyn Winn                |      0.04%      |      23.61%     |      27/100
  Jordan Walker             |      0.02%      |      37.43%     |      10/100
  Victor Scott              |      0.01%      |      39.81%     |      29/100

========================================================================================================================
        `;

        /**
         * Parses the raw text of the home run report into a structured JavaScript object.
         */
        function parseReport(text) {
            const games = [];
            const gameBlocks = text.split(/={80,}/).filter(b => b.trim().startsWith('GAME:'));

            gameBlocks.forEach(block => {
                const lines = block.trim().split('\n');
                const gameTitleLine = lines.find(line => line.startsWith('GAME:'));
                if (!gameTitleLine) return;
                const gameTitle = gameTitleLine.replace('GAME: ', '').trim();
                
                const teamSections = block.split(/-{80,}/).slice(1);
                const teamsData = [];

                teamSections.forEach((section, teamIndex) => {
                    const sectionLines = section.trim().split('\n');
                    if (sectionLines.length < 3) return;

                    const teamTitle = sectionLines[0].trim();
                    const players = [];
                    let hasHighProb = false;

                    for (let i = 2; i < sectionLines.length; i++) {
                        const line = sectionLines[i];
                        if (!line.includes('|') || line.includes('---')) continue;

                        const parts = line.split('|').map(p => p.trim());
                        if (parts.length < 4) continue; // Expect 4 columns now

                        const name = parts[0];
                        const prob90DayStr = parts[1];
                        const prob2YearStr = parts[2];
                        const hrCompScoreStr = parts[3];
                        
                        const prob90DayValue = prob90DayStr.toLowerCase().includes('low data') ? -1 : parseFloat(prob90DayStr);
                        const prob2YearValue = prob2YearStr.toLowerCase().includes('low data') ? -1 : parseFloat(prob2YearStr);
                        const hrCompScoreValue = hrCompScoreStr.toLowerCase().includes('low data') ? -1 : parseInt(hrCompScoreStr);

                        const isHigh = (prob90DayValue >= 50) || (prob2YearValue >= 50);
                        if (isHigh) hasHighProb = true;

                        players.push({ name, prob90DayStr, prob2YearStr, hrCompScoreStr, prob90DayValue, prob2YearValue, hrCompScoreValue, isHigh });
                    }
                    if (players.length > 0) {
                        teamsData.push({ id: `${gameTitle}-${teamIndex}`, title: teamTitle, players, hasHighProb });
                    }
                });
                
                if (teamsData.length > 0) {
                    const gameHasHighProb = teamsData.some(t => t.hasHighProb);
                    games.push({ title: gameTitle, teams: teamsData, hasHighProb: gameHasHighProb });
                }
            });

            return games;
        }

        /**
         * Renders the parsed game data into HTML cards and injects them into the DOM.
         */
        function renderReport(gamesData) {
            const container = document.getElementById('report-container');
            container.innerHTML = ''; // Clear previous content

            gamesData.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'card border overflow-hidden';
                gameCard.dataset.hasHighProb = game.hasHighProb;

                let teamsHtml = '';
                game.teams.forEach(team => {
                    let playersHtml = '';
                    team.players.forEach(player => {
                        const highlightClass = player.isHigh ? 'highlight' : '';
                        
                        playersHtml += `
                            <tr class="player-row ${highlightClass}" data-is-high="${player.isHigh}">
                                <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm player-name">${player.name}</td>
                                <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob90DayStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob90DayStr}</td>
                                <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob2YearStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob2YearStr}</td>
                                <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.hrCompScoreStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.hrCompScoreStr}</td>
                            </tr>
                        `;
                    });
                    
                    const sort90DayClass = currentSort.key === 'prob90DayValue' ? (currentSort.order === 'desc' ? 'sort-desc' : 'sort-asc') : '';
                    const sort2YearClass = currentSort.key === 'prob2YearValue' ? (currentSort.order === 'desc' ? 'sort-desc' : 'sort-asc') : '';
                    const sortHrCompClass = currentSort.key === 'hrCompScoreValue' ? (currentSort.order === 'desc' ? 'sort-desc' : 'sort-asc') : '';

                    teamsHtml += `
                        <div class="p-4" data-team-id="${team.id}">
                            <h3 class="font-semibold text-gray-700 dark:text-gray-300 text-md mb-2">${team.title}</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white dark:bg-gray-800">
                                    <thead class="table-header">
                                        <tr>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Batter</th>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider sortable ${sort90DayClass}" data-sort-key="prob90DayValue">90-Day Prob</th>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider sortable ${sort2YearClass}" data-sort-key="prob2YearValue">2-Year Prob</th>
                                            <th class="py-2 px-4 border-b-2 border-gray-200 dark:border-gray-600 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider sortable ${sortHrCompClass}" data-sort-key="hrCompScoreValue">HR Comp Score</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${playersHtml}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                });

                gameCard.innerHTML = `
                    <div class="bg-gray-800 text-white p-4 game-header">
                        <h2 class="font-bold text-lg">${game.title}</h2>
                    </div>
                    <div class="divide-y divide-gray-200 dark:divide-gray-700">
                        ${teamsHtml}
                    </div>
                `;
                container.appendChild(gameCard);
            });
        }
        
        /**
         * Sorts a specific team's player list and re-renders that table.
         */
        function sortTeam(teamId, sortKey) {
            const teamData = allGamesData.flatMap(g => g.teams).find(t => t.id === teamId);
            if (!teamData) return;

            const order = (currentSort.key === sortKey && currentSort.order === 'desc') ? 'asc' : 'desc';
            currentSort = { key: sortKey, order };

            teamData.players.sort((a, b) => {
                const valA = a[sortKey];
                const valB = b[sortKey];
                return order === 'desc' ? valB - valA : valA - valB;
            });

            const teamContainer = document.querySelector(`[data-team-id="${teamId}"]`);
            if (!teamContainer) return;
            
            const tableBody = teamContainer.querySelector('tbody');
            tableBody.innerHTML = ''; 

            let playersHtml = '';
            teamData.players.forEach(player => {
                const highlightClass = player.isHigh ? 'highlight' : '';
                playersHtml += `
                    <tr class="player-row ${highlightClass}" data-is-high="${player.isHigh}">
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm player-name">${player.name}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob90DayStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob90DayStr}</td>
                        <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.prob2YearStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.prob2YearStr}</td>
                         <td class="py-2 px-4 border-b border-gray-200 dark:border-gray-700 text-sm text-center ${player.hrCompScoreStr.toLowerCase().includes('low data') ? 'low-data' : ''}">${player.hrCompScoreStr}</td>
                    </tr>
                `;
            });
            tableBody.innerHTML = playersHtml;

            teamContainer.querySelectorAll('.sortable').forEach(th => th.classList.remove('sort-asc', 'sort-desc'));
            const activeHeader = teamContainer.querySelector(`[data-sort-key="${sortKey}"]`);
            activeHeader.classList.add(order === 'desc' ? 'sort-desc' : 'sort-asc');
        }


        let isHighlightOnly = false;
        const toggleBtn = document.getElementById('toggle-highlight-btn');
        const noDataMessage = document.getElementById('no-data-message');

        function toggleHighlightView() {
            isHighlightOnly = !isHighlightOnly;
            
            const gameCards = document.querySelectorAll('#report-container .card');
            let visibleCards = 0;

            gameCards.forEach(card => {
                if (isHighlightOnly) {
                    if (card.dataset.hasHighProb === 'true') {
                        card.style.display = 'block';
                        visibleCards++;
                    } else {
                        card.style.display = 'none';
                    }
                    const playerRows = card.querySelectorAll('.player-row');
                    playerRows.forEach(row => {
                        row.style.display = row.dataset.isHigh === 'true' ? 'table-row' : 'none';
                    });
                } else {
                    card.style.display = 'block';
                    visibleCards++;
                    const playerRows = card.querySelectorAll('.player-row');
                    playerRows.forEach(row => {
                        row.style.display = 'table-row';
                    });
                }
            });
            
            if (isHighlightOnly) {
                toggleBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                toggleBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                toggleBtn.textContent = "Show All Players";
            } else {
                toggleBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                toggleBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                toggleBtn.textContent = "Toggle High Probability Players";
            }

            noDataMessage.classList.toggle('hidden', !(isHighlightOnly && visibleCards === 0));
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

            if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                themeToggleLightIcon.classList.remove('hidden');
            } else {
                themeToggleDarkIcon.classList.remove('hidden');
            }

            themeToggleBtn.addEventListener('click', function() {
                themeToggleDarkIcon.classList.toggle('hidden');
                themeToggleLightIcon.classList.toggle('hidden');
                document.documentElement.classList.toggle('dark');
                if (document.documentElement.classList.contains('dark')) {
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    localStorage.setItem('color-theme', 'light');
                }
            });

            // FIX: Parse the entire reportText, not just a subset
            allGamesData = parseReport(reportText);
            renderReport(allGamesData);
            
            toggleBtn.addEventListener('click', toggleHighlightView);

            const container = document.getElementById('report-container');
            container.addEventListener('click', (e) => {
                const header = e.target.closest('.sortable');
                if (header) {
                    const sortKey = header.dataset.sortKey;
                    const teamContainer = header.closest('[data-team-id]');
                    const teamId = teamContainer.dataset.teamId;
                    sortTeam(teamId, sortKey);
                }
            });
        });
    </script>
</body>
</html>

