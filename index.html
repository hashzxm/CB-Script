<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Similarity Slut Report</title>
    <link rel="icon" type="image/png" href="callgirlc.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Force dark theme
        document.documentElement.classList.add('dark');
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        /* All other styles are correct and omitted for brevity */
        .card, .top-picks-card { background-color: #1f2937; border-color: #374151; transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4); }
        .low-data { color: #9ca3af; font-style: italic; }
        .table-header th { background-color: #374151; color: #d1d5db; }
        .player-row:hover { background-color: #374151; }
        .sortable { cursor: pointer; user-select: none; }
        .sortable:hover { background-color: #4b5563; }
        .sort-asc::after { content: ' ▲'; font-size: 0.7em; }
        .sort-desc::after { content: ' ▼'; font-size: 0.7em; }
        .game-header { background-color: #374151; color: #f9fafb; }
        #loading-indicator { display: flex; justify-content: center; align-items: center; height: 80vh; }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.2); border-left-color: #6366f1; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-2 sm:p-4 md:p-6 bg-gray-900 text-gray-100">

    <div id="password-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4 text-gray-100">Access Required</h2>
            <p class="text-gray-400 mb-6">Please enter the password to view the report.</p>
            <form id="password-form">
                <input type="password" id="password-input" class="w-full px-4 py-2 border border-gray-600 rounded-lg mb-4 bg-gray-700 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Password">
                <p id="password-error" class="text-red-500 text-sm mb-4 hidden">Incorrect password. Please try again.</p>
                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">Unlock</button>
            </form>
        </div>
    </div>

    <div id="protected-content" class="hidden">
        <div id="main-content-container"></div>
        <div id="loading-indicator">
            <div class="spinner"></div>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 p-4 hidden">...</div>
    <div id="game-list-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 hidden">...</div>
    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-70 z-50 p-4 hidden flex-col lg:flex-row items-start justify-center gap-4 overflow-y-auto">...</div>
    <div id="stadium-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 hidden">...</div>
    <div id="search-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-start justify-center z-50 p-8 hidden">...</div>

    <script>
        // --- GLOBAL STATE ---
        let finalReportData = [];
        let top100SimSlutsData = [];
        let scheduleData = [];
        let batterAbsData = {};
        let allGamesData = [];
        let topPicksData = [];
        let myPicks = [];
        let currentSort = { key: null, order: 'desc' };
        let userSettings = { isHigh90Day: 4, isHigh2Year: 50, isHighCompScore: 65, highParkFactor: 105 };
        const teamLogoMap = { "Orioles": "BAL", "Phillies": "PHI", "Giants": "SF", "Pirates": "PIT", "Twins": "MIN", "Tigers": "DET", "Guardians": "CLE", "Mets": "NYM", "Reds": "CIN", "Cubs": "CHC", "Yankees": "NYY", "Rangers": "TEX", "Blue Jays": "TOR", "Rockies": "COL", "Rays": "TB", "Angels": "LAA", "Cardinals": "STL", "Dodgers": "LAD", "White Sox": "CHW", "Mariners": "SEA", "Padres": "SD", "Diamondbacks": "ARI", "Athletics": "OAK", "Nationals": "WSH", "Brewers": "MIL", "Braves": "ATL", "Marlins": "MIA", "Astros": "HOU", "Red Sox": "BOS", "Royals": "KC", "ATH": "OAK", "WSN": "WSH", "CHW": "CWS", "SEA": "SEA", "CIN": "CIN", "PIT": "PIT", "MIA": "MIA", "ATL": "ATL" };

        // --- DATA LOADING ---
        async function loadAllData() {
            const loadingIndicator = document.getElementById('loading-indicator');
            try {
                const [finalReportRes, top100Res, scheduleRes, batterAbsRes] = await Promise.all([
                    fetch('FINALREPORT.json'), fetch('Top100SimSluts.json'),
                    fetch('schedule.json'), fetch('batter_last_5_abs.json')
                ]);
                finalReportData = await finalReportRes.json();
                top100SimSlutsData = await top100Res.json();
                scheduleData = await scheduleRes.json();
                batterAbsData = await batterAbsRes.json();
                loadingIndicator.style.display = 'none';
                initializePage();
            } catch (error) {
                loadingIndicator.innerHTML = '<p class="text-red-500 font-semibold">Error: Could not load report data. Please ensure all .json files are in the same directory as report.html.</p>';
                console.error("Failed to load report data:", error);
            }
        }

        // --- PAGE INITIALIZATION ---
        function initializePage() {
            const mainContainer = document.getElementById('main-content-container');
            mainContainer.innerHTML = `
                <div id="main-content">
                    <div class="max-w-7xl mx-auto relative">
                        <div class="absolute top-2 right-2 sm:top-4 sm:right-4 flex items-center gap-2 sm:gap-4 z-20">
                            <button id="search-btn" class="text-gray-400 bg-gray-800/50 hover:bg-gray-700 rounded-lg text-sm p-2.5 shadow-md">...</button>
                            <button id="settings-btn" class="text-gray-400 bg-gray-800/50 hover:bg-gray-700 rounded-lg text-sm p-2.5 shadow-md">...</button>
                            <button id="zxm-button" class="px-3 py-2 sm:px-4 text-xs sm:text-sm bg-gray-800 text-white font-bold rounded-lg shadow-lg hover:bg-black">zxm</button>
                        </div>
                        <header class="text-center pt-4 sm:pt-8 mb-4">...</header>
                        <main>
                            <div class="flex items-center gap-4 my-4">
                                <div id="game-ticker-container" class="flex-grow"><div id="game-ticker-wrapper"></div></div>
                                <button id="all-games-btn" class="action-btn flex-shrink-0">...</button>
                            </div>
                            <div id="focus-view-container" class="hidden space-y-4">...</div>
                            <div id="dashboard-container" class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div id="top-picks-container"></div><div id="top-sim-sluts-container"></div>
                            </div>
                            <div id="grid-container" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                            <div id="picks-container" class="hidden"></div>
                        </main>
                    </div>
                    <footer class="mt-12 text-center">...</footer>
                </div>`;
            runFullApp();
        }

        // =================================================================================
        // THIS IS THE CORE APPLICATION LOGIC
        // =================================================================================
        function runFullApp() {
            // --- DATA PROCESSING AND STATE SETUP ---
            allGamesData = processFinalReport(finalReportData, scheduleData, userSettings);
            topPicksData = processTopPicks(finalReportData);
            try { myPicks = JSON.parse(localStorage.getItem('myPicks')) || []; } catch (e) { myPicks = []; }
            loadSettings();

            // --- GET ALL DOM ELEMENTS ---
            const mainContent = document.getElementById('main-content');
            const dashboardContainer = document.getElementById('dashboard-container');
            const topPicksContainer = document.getElementById('top-picks-container');
            // ... (all other getElementById calls)

            // --- DEFINE ALL HELPER & RENDERING FUNCTIONS ---
            // (processFinalReport, renderGridReport, showModals, populatePitcherModal, etc.)
            // NOTE: All of your functions from the previous working version go here.
            // They are omitted for brevity in this response but MUST be included in your file.
            // Example function:
            function processFinalReport(reportData, schedule, settings) {
                // ... (full function logic) ...
                 if (!reportData) return [];
                const scheduleMap = new Map(schedule.games.map(game => [game.game_id, game]));
                const gamesMap = new Map();
                reportData.forEach(player => {
                    if (!gamesMap.has(player.game_id)) {
                        gamesMap.set(player.game_id, []);
                    }
                    gamesMap.get(player.game_id).push(player);
                });
                const games = [];
                for (const [gameId, players] of gamesMap.entries()) {
                    const scheduleInfo = scheduleMap.get(gameId) || {};
                    const gameData = {
                        title: `${scheduleInfo.away_team || 'Away'} @ ${scheduleInfo.home_team || 'Home'} (${scheduleInfo.time || 'N/A'})`,
                        // ... other game data properties
                        teams: []
                    };
                    const teamsMap = new Map();
                    players.forEach(p => {
                        if (!teamsMap.has(p.pitcher_name)) {
                            teamsMap.set(p.pitcher_name, []);
                        }
                        teamsMap.get(p.pitcher_name).push(p);
                    });
                    for (const [pitcherName, teamPlayers] of teamsMap.entries()) {
                        const teamData = {
                            title: `Batters vs. ${pitcherName}`,
                            pitcherHand: teamPlayers[0]?.pitcher_hand,
                            players: teamPlayers.map(p => ({
                                // ... all player properties
                            }))
                        };
                        gameData.teams.push(teamData);
                    }
                    games.push(gameData);
                }
                return games;
            }
            // ... (Include ALL other helper functions here)

            // --- ATTACH ALL EVENT LISTENERS ---
            const tabItems = document.querySelectorAll('.tab-item');
            tabItems.forEach(tab => {
                tab.addEventListener('click', () => { /* ... tab switching logic ... */ });
            });
            // ... (all other addEventListener calls for modals, search, clicks, etc.)

            // --- INITIAL RENDER ---
            function initialRender() {
                renderTopPicks(topPicksData, topPicksContainer);
                renderTop100SimSluts(topSimSlutsContainer);
                renderGridReport(allGamesData, gridContainer);
                renderGameTicker(allGamesData, gameTickerWrapper);
                setupTickerScrolling();
                applyCascadeAnimation('#dashboard-container');
                moveSlider(document.querySelector('.tab-item.active'));
            }
            initialRender();
        }


        // --- PASSWORD LOGIC (Entry Point) ---
        document.addEventListener('DOMContentLoaded', () => {
            const passwordModal = document.getElementById('password-modal');
            const protectedContent = document.getElementById('protected-content');
            const passwordForm = document.getElementById('password-form');
            const passwordInput = document.getElementById('password-input');
            const passwordError = document.getElementById('password-error');
            const correctPassword = "123456789";
            const authVersion = "v1";

            if (localStorage.getItem('similaritySlutAuth') === authVersion) {
                passwordModal.style.display = 'none';
                protectedContent.classList.remove('hidden');
                loadAllData();
            } else {
                passwordInput.focus();
                passwordForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (passwordInput.value === correctPassword) {
                        localStorage.setItem('similaritySlutAuth', authVersion);
                        passwordModal.style.display = 'none';
                        protectedContent.classList.remove('hidden');
                        loadAllData();
                    } else {
                        passwordError.classList.remove('hidden');
                        passwordInput.value = '';
                        passwordInput.focus();
                    }
                });
            }
        });
    </script>
</body>
</html>
